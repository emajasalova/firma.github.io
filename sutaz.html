<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>S칰콘a쬹치 str치nka</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      background-color: #f4f4f9;
      margin: 0;
      padding: 0;
    }
    h1 {
      margin: 20px 0;
    }
    .cards {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 20px;
      margin-top: 20px;
    }
    .card {
      background: white;
      border: 2px solid #ccc;
      padding: 20px;
      border-radius: 8px;
      width: 200px;
      height: 150px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      cursor: pointer;
    }
    .card:hover {
      border-color: #00aaff;
    }
    .form-container {
      margin-top: 30px;
    }
    input[type="text"] {
      padding: 10px;
      font-size: 16px;
      border: 1px solid #ccc;
      border-radius: 5px;
      width: 200px;
    }
    button {
      padding: 10px 20px;
      font-size: 16px;
      color: white;
      background-color: #00aaff;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      margin-left: 10px;
    }
    button:hover {
      background-color: #007acc;
    }
    .result {
      margin-top: 20px;
      font-size: 18px;
    }
    .winner-list {
      margin-top: 30px;
      padding: 20px;
      background-color: #fff;
      border-radius: 8px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      max-width: 600px;
      margin-left: auto;
      margin-right: auto;
      text-align: left;
    }
    .winner-list h3 {
      margin-bottom: 15px;
    }
    .winner-list ul {
      list-style: none;
      padding: 0;
    }
    .winner-list ul li {
      padding: 8px;
      background-color: #f9f9f9;
      border-bottom: 1px solid #ccc;
    }
  </style>
</head>
<body>
  <h1>S칰콘a쬹치 str치nka</h1>
  <div class="cards">
    <div class="card">N치hodn칠 premie a do 20.000 K캜 K캜</div>
    <div class="card">游끥 N치hodn칠 premie a do 40.000 K캜 K캜</div>
    <div class="card">游끥 N치hodn칠 premie a do 50.000 K캜</div>
    <div class="card">游뚱 Vyhraj Auto Evo IX s polepom</div>
    <div class="card">游눯 N치hodn칠 premie a do 70.000 K캜</div>
  </div>

  <div class="form-container">
    <h2>Zadajte svoje meno a k칩d</h2>
    <input type="text" id="name" placeholder="Zadajte va코e meno">
    <input type="text" id="code" placeholder="Zadajte v치코 k칩d">
    <button id="submit">Odosla콘</button>
  </div>

  <div class="result" id="result"></div>

  <div class="winner-list" id="winnerList">
    <h3>Rozpis prem칤</h3>
    <ul id="winnerListContent">
      <!-- Zoznam v칳hercov sa bude dynamicky generova콘 tu -->
    </ul>
  </div>

<script>
  const apiUrl = "https://674600bf512ddbd807fa7e9e.mockapi.io/etsst";

  // Funkcia na na캜칤tanie v칳hercov pri na캜칤tan칤 str치nky
  async function loadWinners() {
    try {
      const response = await fetch(apiUrl);
      const data = await response.json();
      const winnerListContent = document.getElementById("winnerListContent");
      winnerListContent.innerHTML = ""; // Vyma쬰me existuj칰ci zoznam

      data.forEach(winner => {
        if (winner.used) {
          const newWinnerItem = document.createElement("li");
          newWinnerItem.textContent = `${winner.name} - ${winner.prize}`;
          winnerListContent.appendChild(newWinnerItem);
        }
      });
    } catch (error) {
      console.error("Chyba pri na캜칤tan칤 v칳hercov:", error);
    }
  }

  // Na캜칤tanie v칳hercov pri na캜칤tan칤 str치nky
  window.onload = loadWinners;

  document.getElementById("submit").addEventListener("click", async () => {
    const name = document.getElementById("name").value.trim();
    const code = document.getElementById("code").value.trim();
    const result = document.getElementById("result");

    if (!name || !code) {
      result.textContent = "Pros칤m, zadajte svoje meno a k칩d!";
      return;
    }

    try {
      // Overenie, 캜i k칩d existuje v MockAPI
      const response = await fetch(`${apiUrl}?code=${code}`);
      const data = await response.json();

      // Skontrolujeme, 캜i je k칩d platn칳 a e코te nebol pou쬴t칳
      if (data.length === 0 || data[0].used) {
        result.textContent = "K칩d neexistuje alebo u bol pou쬴t칳!";
        return;
      }

      // Generovanie n치hodnej v칳hry
      const prizes = [
        "5 000 K캜", "10 000 K캜", "13 000 K캜", "15 000 K캜", "18 000 K캜", 
        "19 500 K캜", "22 000 K캜", "30 000 K캜", "26 000 K캜", "35 000 K캜",
        "37 000 K캜", "40 000 K캜", "42 000 K캜", "39 000 K캜", "50 000 K캜",
      ];

      const probabilities = [
        0.1, 0.1, 0.1, 0.1, 0.1, 
        0.1, 0.1, 0.1, 0.1, 0.1, 
        0.1, 0.1, 0.1, 0.1, 0.1
      ];

      const random = Math.random();
      let cumulativeProbability = 0;
      let prize = "콯iadna v칳hra";

      for (let i = 0; i < prizes.length; i++) {
        cumulativeProbability += probabilities[i];
        if (random <= cumulativeProbability) {
          prize = prizes[i];
          break;
        }
      }

      // Z칤skanie ID z치znamu v MockAPI a pridanie v칳hry
      const id = data[0].id; // ID z치znamu v MockAPI

      // Aktualiz치cia z치znamu o k칩de, ozna캜칤me ho ako pou쬴t칳
      await fetch(`${apiUrl}/${id}`, {
        method: "PUT",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify({
          ...data[0], // zachov치me existuj칰ce 칰daje
          prize: prize, // prid치me v칳hru
          used: true, // ozna캜칤me k칩d ako pou쬴t칳
          name: name // ulo쮂셠e meno v칳hercu
        })
      });

      result.textContent = `Gratulujeme, ${name}! Z칤skavate premiu: ${prize}`;

      // Prid치me v칳hercu do zoznamu
      const winnerListContent = document.getElementById("winnerListContent");
      const newWinnerItem = document.createElement("li");
      newWinnerItem.textContent = `${name} - ${prize}`;
      winnerListContent.appendChild(newWinnerItem);
    } catch (error) {
      result.textContent = "Do코lo k chybe pri spracovan칤 po쬴adavky!";
    }
  });
</script>

</body>
</html>
