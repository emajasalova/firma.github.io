<script>
    const apiUrl = "https://674600bf512ddbd807fa7e9e.mockapi.io/etsst";
    const validCode = "vyhravatecamuspozvanku";

    document.getElementById("submit").addEventListener("click", async () => {
        const code = document.getElementById("code").value.trim();
        const result = document.getElementById("result");

        if (!code) {
            result.textContent = "Zadajte kód!";
            return;
        }

        try {
            // Overenie, či kód existuje v MockAPI
            const response = await fetch(`${apiUrl}?code=${code}`);
            const data = await response.json();

            if (data.length === 0) {
                result.textContent = "Kód neexistuje alebo už bol použitý!";
                return;
            }

            // Generovanie náhodnej výhry
const prizes = [
    "500 Kč", "1.000 Kč", "1.500 Kč", "2.000 Kč", "2.500 Kč", 
    "3.000 Kč", "3.500 Kč", "4.000 Kč", "4.500 Kč", "5.000 Kč",
    "5.500 Kč", "6.000 Kč", "6.500 Kč", "7.000 Kč", "7.500 Kč",
    "8.000 Kč", "8.500 Kč", "9.000 Kč", "9.500 Kč", "10.000 Kč",
    "11.000 Kč", "12.000 Kč", "13.000 Kč", "14.000 Kč", "15.000 Kč",
    "16.000 Kč", "17.000 Kč", "18.000 Kč", "19.000 Kč", "20.000 Kč",
    "25.000 Kč", "30.000 Kč", "35.000 Kč", "40.000 Kč", "45.000 Kč",
    "50.000 Kč", "60.000 Kč", "70.000 Kč", "80.000 Kč", "90.000 Kč",
    "100.000 Kč", "150.000 Kč", "200.000 Kč", "250.000 Kč", "300.000 Kč",
    "400.000 Kč", "500.000 Kč", "600.000 Kč", "700.000 Kč", "Auto Evo IX s polepom"
];

// Pravdepodobnosti pre jednotlivé výhry
const probabilities = [
    0.1, 0.09, 0.08, 0.08, 0.07, 
    0.06, 0.06, 0.05, 0.05, 0.04, 
    0.04, 0.03, 0.03, 0.025, 0.025, 
    0.02, 0.02, 0.02, 0.015, 0.015,
    0.01, 0.01, 0.01, 0.009, 0.009, 
    0.008, 0.008, 0.007, 0.007, 0.006,
    0.005, 0.005, 0.004, 0.004, 0.003,
    0.003, 0.0025, 0.0025, 0.002, 0.002,
    0.0015, 0.0015, 0.001, 0.001, 0.0008, 
    0.0007, 0.0005, 0.0003, 0.0002, 0.0001 // Najnižšia šanca na auto
];

            const random = Math.random();
            let cumulativeProbability = 0;
            let prize = "Žiadna výhra";

            for (let i = 0; i < prizes.length; i++) {
                cumulativeProbability += probabilities[i];
                if (random <= cumulativeProbability) {
                    prize = prizes[i];
                    break;
                }
            }

            // Aktualizácia výsledku a mazanie použitého kódu
            const id = data[0].id; // ID záznamu v MockAPI
            await fetch(`${apiUrl}/${id}`, {
                method: "DELETE",
            });

            result.textContent = `Gratulujeme! Vyhrali ste: ${prize}`;
        } catch (error) {
            result.textContent = "Došlo k chybe pri spracovaní požiadavky!";
        }
    });
</script>

